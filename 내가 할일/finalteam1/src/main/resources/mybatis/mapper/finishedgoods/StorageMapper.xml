<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.finalproject.finalteam1.mapper.finishedgoods.StorageMapper">
    <insert id="storageInsert">
        INSERT INTO FINISHEDGOODSSTORAGE
        VALUES(FINISHEDGOODSSTORAGE_SEQ.NEXTVAL,
        #{storage_address},
        #{storage_name},
        0,
        #{storage_total_amount})
    </insert>

    <select id="storageSelect" resultType="com.finalproject.finalteam1.domain.finishedgoods.StorageVO">
        SELECT *
        FROM FINISHEDGOODSSTORAGE
        WHERE STORAGE_NAME LIKE '%'||#{storage.storage_name}||'%'
        <if test="storage.storage_current_amount == 0">
            <![CDATA[
                AND STORAGE_CURRENT_AMOUNT<STORAGE_TOTAL_AMOUNT
            ]]>
        </if>
        <if test="storage.storage_current_amount == 1">
            <![CDATA[
                AND STORAGE_CURRENT_AMOUNT>=STORAGE_TOTAL_AMOUNT
            ]]>
        </if>
        ORDER BY STORAGE_ID OFFSET (#{paging.pageNum}-1)*#{paging.pageSize} ROWS FETCH NEXT #{paging.pageSize} ROW ONLY
    </select>

    <select id="storageMaxCount" resultType="Integer">
        SELECT COUNT(*)
        FROM FINISHEDGOODSSTORAGE
        WHERE STORAGE_NAME LIKE '%'||#{storage.storage_name}||'%'
        <if test="storage.storage_current_amount == 0">
            <![CDATA[
                AND STORAGE_CURRENT_AMOUNT<STORAGE_TOTAL_AMOUNT
            ]]>
        </if>
        <if test="storage.storage_current_amount == 1">
            <![CDATA[
                AND STORAGE_CURRENT_AMOUNT>=STORAGE_TOTAL_AMOUNT
            ]]>
        </if>
    </select>

    <delete id="storageDelete">
        DELETE FROM FINISHEDGOODSSTORAGE WHERE STORAGE_ID = #{storage_id}
    </delete>

    <update id="storageUpdate">
        UPDATE FINISHEDGOODSSTORAGE
        SET STORAGE_ADDRESS = #{storage_address} , STORAGE_TOTAL_AMOUNT = #{storage_total_amount}
        WHERE STORAGE_ID = #{storage_id}
    </update>
</mapper>